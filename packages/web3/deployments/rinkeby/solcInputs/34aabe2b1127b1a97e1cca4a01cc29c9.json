{
  "language": "Solidity",
  "sources": {
    "contracts/Crowdfunding.sol": {
      "content": "//SPDX-License-Identifier: Unlicense\npragma solidity ^0.8.0;\nimport './Project.sol';\n\ncontract Crowdfunding{\n\n// [X] Anyone can start a funding project .\n// [X] Get All project list\n// [X]  contribute amount\n\nevent ProjectStarted(\n    address projectContractAddress ,\n    address creator,\n    uint256 minContribution,\n    uint256 projectDeadline,\n    uint256 goalAmount,\n    uint256 currentAmount,\n    uint256 noOfContributors,\n    string title,\n    string desc,\n    uint256 currentState\n);\n\nevent ContributionReceived(\n   address projectAddress,\n   uint256 contributedAmount,\n   address indexed contributor\n);\n\n Project[] private projects;\n\n  // @dev Anyone can start a fund rising\n // @return null\n\n function createProject(\n    uint256 minimumContribution,\n    uint256 deadline,\n    uint256 targetContribution,\n    string memory projectTitle,\n    string memory projectDesc\n ) public {\n\n   deadline = deadline;\n\n   Project newProject = new Project(msg.sender,minimumContribution,deadline,targetContribution,projectTitle,projectDesc);\n   projects.push(newProject);\n \n emit ProjectStarted(\n    address(newProject) ,\n    msg.sender,\n    minimumContribution,\n    deadline,\n    targetContribution,\n    0,\n    0,\n    projectTitle,\n    projectDesc,\n    0\n );\n\n }\n\n // @dev Get projects list\n// @return array\n\nfunction returnAllProjects() external view returns(Project[] memory){\n   return projects;\n}\n\n// @dev User can contribute\n// @return null\n\nfunction contribute(address _projectAddress) public payable{\n\n   uint256 minContributionAmount = Project(_projectAddress).minimumContribution();\n   Project.State projectState = Project(_projectAddress).state();\n   require(projectState == Project.State.Fundraising,'Invalid state');\n   require(msg.value >= minContributionAmount,'Contribution amount is too low !');\n   // Call function\n   Project(_projectAddress).contribute{value:msg.value}(msg.sender);\n   // Trigger event \n   emit ContributionReceived(_projectAddress,msg.value,msg.sender);\n}\n\n}\n\n"
    },
    "contracts/Project.sol": {
      "content": "//SPDX-License-Identifier: Unlicense\npragma solidity ^0.8.0;\n\n// [X] Anyone can contribute\n// [X] End project if targeted contribution amount reached\n// [X] Expire project if raised amount not fullfill between deadline\n//    & return donated amount to all contributor .\n// [X] Owner need to request contributers for withdraw amount.\n// [X] Owner can withdraw amount if 50% contributors agree\n\ncontract Project{\n\n   // Project state\n    enum State {\n        Fundraising,\n        Expired,\n        Successful\n    }\n\n    // Structs\n\n    struct WithdrawRequest{\n        string description;\n        uint256 amount;\n        uint256 noOfVotes;\n        mapping(address => bool) voters;\n        bool isCompleted;\n        address payable reciptent;\n    }\n\n    // Variables\n    address payable public creator;\n    uint256 public minimumContribution;\n    uint256 public deadline;\n    uint256 public targetContribution; // required to reach at least this much amount\n    uint public completeAt;\n    uint256 public raisedAmount; // Total raised amount till now\n    uint256 public noOfContributers;\n    string public projectTitle;\n    string public projectDes;\n    State public state = State.Fundraising; \n\n    mapping (address => uint) public contributiors;\n    mapping (uint256 => WithdrawRequest) public withdrawRequests;\n\n    uint256 public numOfWithdrawRequests = 0;\n\n    // Modifiers\n    modifier isCreator(){\n        require(msg.sender == creator,'You dont have access to perform this operation !');\n        _;\n    }\n\n    modifier validateExpiry(State _state){\n        require(state == _state,'Invalid state');\n        require(block.timestamp < deadline,'Deadline has passed !');\n        _;\n    }\n\n    // Events\n\n    // Event that will be emitted whenever funding will be received\n    event FundingReceived(address contributor, uint amount, uint currentTotal);\n    // Event that will be emitted whenever withdraw request created\n    event WithdrawRequestCreated(\n        uint256 requestId,\n        string description,\n        uint256 amount,\n        uint256 noOfVotes,\n        bool isCompleted,\n        address reciptent\n    );\n    // Event that will be emitted whenever contributor vote for withdraw request\n    event WithdrawVote(address voter, uint totalVote);\n    // Event that will be emitted whenever contributor vote for withdraw request\n    event AmountWithdrawSuccessful(\n        uint256 requestId,\n        string description,\n        uint256 amount,\n        uint256 noOfVotes,\n        bool isCompleted,\n        address reciptent\n    );\n\n\n    // @dev Create project\n    // @return null\n\n   constructor(\n       address _creator,\n       uint256 _minimumContribution,\n       uint256 _deadline,\n       uint256 _targetContribution,\n       string memory _projectTitle,\n       string memory _projectDes\n   ) {\n       creator = payable(_creator);\n       minimumContribution = _minimumContribution;\n       deadline = _deadline;\n       targetContribution = _targetContribution;\n       projectTitle = _projectTitle;\n       projectDes = _projectDes;\n       raisedAmount = 0;\n   }\n\n    // @dev Anyone can contribute\n    // @return null\n\n    function contribute(address _contributor) public validateExpiry(State.Fundraising) payable {\n        require(msg.value >= minimumContribution,'Contribution amount is too low !');\n        if(contributiors[_contributor] == 0){\n            noOfContributers++;\n        }\n        contributiors[_contributor] += msg.value;\n        raisedAmount += msg.value;\n        emit FundingReceived(_contributor,msg.value,raisedAmount);\n        checkFundingCompleteOrExpire();\n    }\n\n    // @dev complete or expire funding\n    // @return null\n\n    function checkFundingCompleteOrExpire() internal {\n        if(raisedAmount >= targetContribution){\n            state = State.Successful; \n        }else if(block.timestamp > deadline){\n            state = State.Expired; \n        }\n        completeAt = block.timestamp;\n    }\n\n    // @dev Get contract current balance\n    // @return uint \n\n    function getContractBalance() public view returns(uint256){\n        return address(this).balance;\n    }\n\n    // @dev Request refunt if funding expired\n    // @return boolean\n\n    function requestRefund() public validateExpiry(State.Expired) returns(bool) {\n        require(contributiors[msg.sender] > 0,'You dont have any contributed amount !');\n        address payable user = payable(msg.sender);\n        user.transfer(contributiors[msg.sender]);\n        contributiors[msg.sender] = 0;\n        return true;\n    }\n\n    // @dev Request contributor for withdraw amount\n    // @return null\n   \n    function createWithdrawRequest(string memory _description,uint256 _amount,address payable _reciptent) public isCreator() validateExpiry(State.Successful) {\n        WithdrawRequest storage newRequest = withdrawRequests[numOfWithdrawRequests];\n        numOfWithdrawRequests++;\n\n        newRequest.description = _description;\n        newRequest.amount = _amount;\n        newRequest.noOfVotes = 0;\n        newRequest.isCompleted = false;\n        newRequest.reciptent = _reciptent;\n\n        emit WithdrawRequestCreated(numOfWithdrawRequests,_description, _amount,0,false,_reciptent );\n    }\n\n    // @dev contributors can vote for withdraw request\n    // @return null\n\n    function voteWithdrawRequest(uint256 _requestId) public {\n        require(contributiors[msg.sender] > 0,'Only contributor can vote !');\n        WithdrawRequest storage requestDetails = withdrawRequests[_requestId];\n        require(requestDetails.voters[msg.sender] == false,'You already voted !');\n        requestDetails.voters[msg.sender] = true;\n        requestDetails.noOfVotes += 1;\n        emit WithdrawVote(msg.sender,requestDetails.noOfVotes);\n    }\n\n    // @dev Owner can withdraw requested amount\n    // @return null\n\n    function withdrawRequestedAmount(uint256 _requestId) isCreator() validateExpiry(State.Successful) public{\n        WithdrawRequest storage requestDetails = withdrawRequests[_requestId];\n        require(requestDetails.isCompleted == false,'Request already completed');\n        require(requestDetails.noOfVotes >= noOfContributers/2,'At least 50% contributor need to vote for this request');\n        requestDetails.reciptent.transfer(requestDetails.amount);\n        requestDetails.isCompleted = true;\n\n        emit AmountWithdrawSuccessful(\n            _requestId,\n            requestDetails.description,\n            requestDetails.amount,\n            requestDetails.noOfVotes,\n            true,\n            requestDetails.reciptent\n        );\n\n    }\n\n    // @dev Get contract details\n    // @return all the project's details\n\n    function getProjectDetails() public view returns(\n    address payable projectStarter,\n    uint256 minContribution,\n    uint256  projectDeadline,\n    uint256 goalAmount, \n    uint completedTime,\n    uint256 currentAmount, \n    string memory title,\n    string memory desc,\n    State currentState,\n    uint256 balance\n    ){\n        projectStarter=creator;\n        minContribution=minimumContribution;\n        projectDeadline=deadline;\n        goalAmount=targetContribution;\n        completedTime=completeAt;\n        currentAmount=raisedAmount;\n        title=projectTitle;\n        desc=projectDes;\n        currentState=state;\n        balance=address(this).balance;\n    }\n\n}"
    }
  },
  "settings": {
    "optimizer": {
      "enabled": false,
      "runs": 200
    },
    "outputSelection": {
      "*": {
        "*": [
          "abi",
          "evm.bytecode",
          "evm.deployedBytecode",
          "evm.methodIdentifiers",
          "metadata",
          "devdoc",
          "userdoc",
          "storageLayout",
          "evm.gasEstimates"
        ],
        "": [
          "ast"
        ]
      }
    },
    "metadata": {
      "useLiteralContent": true
    }
  }
}